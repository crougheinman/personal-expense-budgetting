<div class="receipt-scanner">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <mat-icon>camera_alt</mat-icon>
        Scan Receipt
      </mat-card-title>
      <mat-card-subtitle>
        Capture or upload a receipt to automatically extract expense details
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Error Message -->
      <div *ngIf="errorMessage" class="error-message">
        <mat-icon color="warn">error</mat-icon>
        <span>{{ errorMessage }}</span>
      </div>

      <!-- Processing Indicator -->
      <div *ngIf="isProcessing" class="processing-indicator">
        <mat-spinner diameter="40"></mat-spinner>
        <p>{{ getProcessingMessage() }}</p>
      </div>

      <!-- Camera Section -->
      <div *ngIf="!isProcessing && !imagePreview" class="camera-section">
        
        <!-- Camera View -->
        <div *ngIf="cameraActive" class="camera-view">
          <video 
            #videoElement 
            autoplay 
            playsinline
            class="video-preview">
          </video>
          
          <div class="camera-controls">
            <button 
              mat-fab 
              color="primary" 
              (click)="capturePhoto()"
              class="capture-button">
              <mat-icon>camera</mat-icon>
            </button>
            <button 
              mat-stroked-button 
              color="warn" 
              (click)="stopCamera()"
              class="stop-button">
              <mat-icon>stop</mat-icon>
              Stop Camera
            </button>
          </div>
        </div>

        <!-- Camera Launch -->
        <div *ngIf="!cameraActive" class="camera-launch">
          <div class="launch-options">
            
            <!-- Camera Option -->
            <div *ngIf="cameraSupported" class="option-card">
              <mat-icon class="option-icon">camera_alt</mat-icon>
              <h3>Take Photo</h3>
              <p>Use your camera to capture a receipt</p>
              <button 
                mat-raised-button 
                color="primary" 
                (click)="startCamera()">
                <mat-icon>camera_alt</mat-icon>
                Start Camera
              </button>
            </div>

            <!-- File Upload Option -->
            <div class="option-card">
              <mat-icon class="option-icon">upload_file</mat-icon>
              <h3>Upload Image</h3>
              <p>Select a receipt image from your device</p>
              <input 
                #fileInput
                type="file" 
                accept="image/*" 
                (change)="onFileSelected($event)"
                style="display: none;">
              <button 
                mat-raised-button 
                color="accent"
                (click)="fileInput.click()">
                <mat-icon>upload_file</mat-icon>
                Choose File
              </button>
            </div>

          </div>

          <!-- Camera Not Supported -->
          <div *ngIf="!cameraSupported" class="camera-not-supported">
            <mat-icon color="warn">camera_off</mat-icon>
            <p>Camera is not supported on this device</p>
          </div>
        </div>
      </div>

      <!-- Image Preview -->
      <div *ngIf="imagePreview && !isProcessing" class="image-preview">
        <img [src]="imagePreview" alt="Receipt preview" class="preview-image">
        
        <div class="preview-controls">
          <button 
            mat-stroked-button 
            color="primary" 
            (click)="retakePhoto()">
            <mat-icon>refresh</mat-icon>
            Retake
          </button>
        </div>
      </div>

    </mat-card-content>

    <mat-card-actions align="end">
      <button 
        mat-button 
        color="warn" 
        (click)="cancel()"
        [disabled]="isProcessing">
        Cancel
      </button>
    </mat-card-actions>

  </mat-card>
</div>
